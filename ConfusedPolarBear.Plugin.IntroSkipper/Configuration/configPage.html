<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
</head>

<body>
    <div id="TemplateConfigPage" data-role="page" class="page type-interior pluginConfigurationPage"
         data-require="emby-input,emby-button,emby-select,emby-checkbox,emby-linkbutton">
        <div data-role="content">
            <style>
                summary {
                    cursor: pointer;
                    padding: 10px;
                    width: inherit;
                    margin: auto;
                    border: none;
                    text-align: center;
                    outline: none;
                    font-size: 1.0em;
                    outline: 2px solid rgba(155, 155, 155, 0.5);
                }
            </style>
            <div class="content-primary">
                <form id="FingerprintConfigForm">
                    <fieldset class="verticalSection-extrabottompadding">
                        <legend>Analysis</legend>

                        <div class="checkboxContainer checkboxContainer-withDescription">
                            <label class="emby-checkbox-label">
                                <input id="AutoDetectIntros" type="checkbox" is="emby-checkbox" />
                                <span>Automatically Scan Intros</span>
                            </label>

                            <div class="fieldDescription">
                                If enabled, introductions will be automatically analyzed for new media
                            </div>
                        </div>

                        <div class="checkboxContainer checkboxContainer-withDescription">
                            <label class="emby-checkbox-label">
                                <input id="AutoDetectCredits" type="checkbox" is="emby-checkbox" />
                                <span>Automatically Scan Credits</span>
                            </label>

                            <div class="fieldDescription">
                                If enabled, credits will be automatically analyzed for new media
                                <br />
                                <br />
                                Note: Not selecting at least one automatic detection type will disable automatic scans. To configure the scheduled task, see <a is="emby-linkbutton" class="button-link" href="#/dashboard/tasks">scheduled tasks</a>.
                            </div>
                        </div>

                        <div class="checkboxContainer checkboxContainer-withDescription">
                            <label class="emby-checkbox-label">
                                <input id="AnalyzeSeasonZero" type="checkbox" is="emby-checkbox" />
                                <span>Analyze season 0</span>
                            </label>

                            <div class="fieldDescription">
                                If checked, season 0 (specials / extras) will be included in analysis.
                                <br />
                                <br />
                                Note: Shows containing both a specials and extra folder will identify extras as season 0
                                and ignore specials, regardless of this setting.
                            </div>
                        </div>

                        <div class="inputContainer">
                            <label class="inputLabel inputLabelUnfocused" for="MaxParallelism">
                                Maximum degree of parallelism
                            </label>
                            <input id="MaxParallelism" type="number" is="emby-input" min="1" />
                            <div class="fieldDescription">
                                Maximum number of simultaneous async episode analysis operations.
                            </div>
                        </div>

                        <div class="inputContainer">
                            <label class="inputLabel inputLabelUnfocused" for="SelectedLibraries">
                                Limit analysis to the following libraries
                            </label>
                            <input id="SelectedLibraries" type="text" is="emby-input" />
                            <div class="fieldDescription">
                                Enter the names of libraries to analyze, separated by commas. If this field is left
                                blank, all libraries on the server containing television episodes will be analyzed.
                            </div>
                        </div>

                        <details id="intro_reqs">
                            <summary>Modify Segment Parameters</summary>

                            <br />
                            <div class="inputContainer">
                                <label class="inputLabel inputLabelUnfocused" for="AnalysisPercent">
                                    Percent of audio to analyze
                                </label>
                                <input id="AnalysisPercent" type="number" is="emby-input" min="1" max="90" />
                                <div class="fieldDescription">
                                    Analysis will be limited to this percentage of each episode's audio. For example, a
                                    value of 25 (the default) will limit analysis to the first quarter of each episode.
                                </div>
                            </div>

                            <div class="inputContainer">
                                <label class="inputLabel inputLabelUnfocused" for="AnalysisLengthLimit">
                                    Maximum runtime of audio to analyze (in minutes)
                                </label>
                                <input id="AnalysisLengthLimit" type="number" is="emby-input" min="1" />
                                <div class="fieldDescription">
                                    Analysis will be limited to this amount of each episode's audio. For example, a
                                    value of 10 (the default) will limit analysis to the first 10 minutes of each
                                    episode.
                                </div>
                            </div>

                            <div class="inputContainer">
                                <label class="inputLabel inputLabelUnfocused" for="MinimumIntroDuration">
                                    Minimum introduction duration (in seconds)
                                </label>
                                <input id="MinimumIntroDuration" type="number" is="emby-input" min="1" />
                                <div class="fieldDescription">
                                    Similar sounding audio which is shorter than this duration will not be considered an
                                    introduction.
                                </div>
                            </div>

                            <div class="inputContainer">
                                <label class="inputLabel inputLabelUnfocused" for="MaximumIntroDuration">
                                    Maximum introduction duration (in seconds)
                                </label>
                                <input id="MaximumIntroDuration" type="number" is="emby-input" min="1" />
                                <div class="fieldDescription">
                                    Similar sounding audio which is longer than this duration will not be considered an
                                    introduction.
                                </div>
                            </div>

                            <div class="inputContainer">
                                <label class="inputLabel inputLabelUnfocused" for="MinimumCreditsDuration">
                                    Minimum credits duration (in seconds)
                                </label>
                                <input id="MinimumCreditsDuration" type="number" is="emby-input" min="1" />
                                <div class="fieldDescription">
                                    Similar sounding audio which is shorter than this duration will not be considered credits.
                                </div>
                            </div>

                            <div class="inputContainer">
                                <label class="inputLabel inputLabelUnfocused" for="MaximumCreditsDuration">
                                    Maximum credits duration (in seconds)
                                </label>
                                <input id="MaximumCreditsDuration" type="number" is="emby-input" min="1" />
                                <div class="fieldDescription">
                                    Similar sounding audio which is longer than this duration will not be considered credits.
                                </div>
                            </div>

                            <p>
                                The amount of each episode's audio that will be analyzed is determined using both
                                the percentage of audio and maximum runtime of audio to analyze. The minimum of
                                (episode duration * percent, maximum runtime) is the amount of audio that will
                                be analyzed.
                            </p>

                            <p>
                                If the audio percentage or maximum runtime settings are modified, the cached
                                fingerprints and introduction timestamps for each season you want to analyze with the
                                modified settings <strong>will have to be deleted.</strong>

                                Increasing either of these settings will cause episode analysis to take much longer.
                            </p>
                        </details>

                        <details id="edl">
                            <summary>EDL File Generation</summary>

                            <br />
                            <div class="selectContainer">
                                <label class="selectLabel" for="EdlAction">EDL Action</label>
                                <select is="emby-select" id="EdlAction" class="emby-select-withcolor emby-select">
                                    <option value="None">
                                        None (do not create or modify EDL files)
                                    </option>

                                    <option value="CommercialBreak">
                                        Commercial Break (recommended, skips past the intro once)
                                    </option>

                                    <option value="Cut">
                                        Cut (player will remove the intro from the video)
                                    </option>

                                    <option value="Intro">
                                        Intro/Credit (show a skip button, *experimental*)
                                    </option>

                                    <option value="Mute">
                                        Mute (audio will be muted)
                                    </option>

                                    <option value="SceneMarker">
                                        Scene Marker (create a chapter marker)
                                    </option>
                                </select>

                                <div class="fieldDescription">
                                    If set to a value other than None, specifies which action to write to
                                    <a href="https://kodi.wiki/view/Edit_decision_list">MPlayer compatible EDL files</a>
                                    alongside your episode files. <br />

                                    If this value is changed after EDL files are generated, you must check the
                                    "Regenerate EDL files" checkbox below.
                                </div>
                            </div>

                            <div class="checkboxContainer checkboxContainer-withDescription">
                                <label class="emby-checkbox-label">
                                    <input id="RegenerateEdlFiles" type="checkbox" is="emby-checkbox" />
                                    <span>Regenerate EDL files during next scan</span>
                                </label>

                                <div class="fieldDescription">
                                    If checked, the plugin will <strong>overwrite all EDL files</strong> associated with
                                    your episodes with the currently discovered introduction/credit timestamps and EDL action.
                                </div>
                            </div>
                        </details>

                        <details id="silence">
                            <summary>Silence Detection Options</summary>

                            <br />
                            <div class="inputContainer">
                                <label class="inputLabel inputLabelUnfocused" for="SilenceDetectionMaximumNoise">
                                    Noise tolerance
                                </label>
                                <input id="SilenceDetectionMaximumNoise" type="number" is="emby-input" min="-90"
                                       max="0" />
                                <div class="fieldDescription">
                                    Noise tolerance in negative decibels.
                                </div>
                            </div>

                            <div class="inputContainer">
                                <label class="inputLabel inputLabelUnfocused" for="SilenceDetectionMinimumDuration">
                                    Minimum silence duration
                                </label>
                                <input id="SilenceDetectionMinimumDuration" type="number" is="emby-input" min="0"
                                       step="0.01" />
                                <div class="fieldDescription">
                                    Minimum silence duration in seconds before adjusting introduction end time.
                                </div>
                            </div>
                        </details>

                        <details id="detection">
                            <summary>Process Configuration</summary>

                            <br />
                            <div class="checkboxContainer checkboxContainer-withDescription">
                                <label class="emby-checkbox-label">
                                    <input id="UseChromaprint" type="checkbox" is="emby-checkbox" />
                                    <span>Chromaprint analysis</span>
                                </label>

                                <div class="fieldDescription">
                                    If checked, analysis will use Chromaprint to compare episode audio and identify intros.
                                    <br />
                                    <strong>WARNING: Disabling this option may result in incomplete or innaccurate analysis!</strong>
                                    <br />
                                </div>
                            </div>

                            <div class="checkboxContainer checkboxContainer-withDescription">
                                <label class="emby-checkbox-label">
                                    <input id="CacheFingerprints" type="checkbox" is="emby-checkbox" />
                                    <span>Cache episode fingerprints</span>
                                </label>

                                <div class="fieldDescription">
                                    If checked, episode fingerprints will be saved on the filesystem to improve analysis speed.
                                    <br />
                                    <strong>WARNING: Disabling the cache will cause all libraries to be re-scanned, which can take a very long time!</strong>
                                    <br />
                                </div>
                            </div>

                            <div class="selectContainer">
                                <label class="selectLabel" for="ProcessPriority">ffmpeg Priority</label>
                                <select is="emby-select" id="ProcessPriority" class="emby-select-withcolor emby-select">
                                    <option value="Idle">
                                        Idle
                                    </option>

                                    <option value="BelowNormal">
                                        Below Normal
                                    </option>

                                    <option value="Normal">
                                        Normal
                                    </option>

                                    <option value="AboveNormal">
                                        Above Normal
                                    </option>

                                    <option value="High">
                                        High
                                    </option>

                                    <option value="RealTime">
                                        Highest
                                    </option>
                                </select>

                                <div class="fieldDescription">
                                    Sets the relative priority of the analysis ffmpeg process to other parallel operations
                                    (ie. transcoding, chapter detection, etc).
                                </div>
                            </div>

                            <div class="inputContainer">
                                <label class="inputLabel inputLabelUnfocused" for="ProcessThreads">
                                    ffmpeg Threads
                                </label>
                                <input id="ProcessThreads" type="number" is="emby-input" min="0"
                                       max="16" />
                                <div class="fieldDescription">
                                    Number of simultaneous processes to use for ffmpeg operations.
                                    <br />
                                    This value is most often defined as 1 thread per CPU core,
                                    but setting a value of 0 (default) will use the maximum threads available.
                                </div>
                            </div>
                        </details>
                    </fieldset>

                    <fieldset class="verticalSection-extrabottompadding">
                        <legend>Playback</legend>

                        <div class="checkboxContainer checkboxContainer-withDescription">
                            <label class="emby-checkbox-label">
                                <input id="AutoSkip" type="checkbox" is="emby-checkbox" />
                                <span>Automatically skip intros</span>
                            </label>

                            <div class="fieldDescription">
                                If checked, intros will be automatically skipped. If you access Jellyfin through a
                                reverse proxy, it must be configured to proxy web
                                sockets.<br />
                            </div>
                        </div>

                        <div id="divSkipFirstEpisode" class="checkboxContainer checkboxContainer-withDescription">
                            <label class="emby-checkbox-label">
                                <input id="SkipFirstEpisode" type="checkbox" is="emby-checkbox" />
                                <span>Play intro for first episode of a season</span>
                            </label>

                            <div class="fieldDescription">
                                If checked, auto skip will play the introduction of the first episode in a season.<br />
                            </div>
                            <br />
                        </div>

                        <div class="checkboxContainer checkboxContainer-withDescription">
                            <label class="emby-checkbox-label">
                                <input id="AutoSkipCredits" type="checkbox" is="emby-checkbox" />
                                <span>Automatically skip credits</span>
                            </label>

                            <div class="fieldDescription">
                                If checked, credits will be automatically skipped. If you access Jellyfin through a
                                reverse proxy, it must be configured to proxy web
                                sockets.<br />
                            </div>
                        </div>

                        <div class="checkboxContainer checkboxContainer-withDescription">
                            <label class="emby-checkbox-label">
                                <input id="SkipButtonVisible" type="checkbox" is="emby-checkbox" />
                                <span>Show skip intro button</span>
                            </label>

                            <div class="fieldDescription">
                                If checked, a skip button will be displayed at the start of an episode's introduction.
                                <strong>Only applies to the web interface and compatible applications.</strong>
                                <br />
                            </div>
                        </div>

                        <div class="checkboxContainer checkboxContainer-withDescription">
                            <label class="emby-checkbox-label">
                                <input id="PersistSkipButton" type="checkbox" is="emby-checkbox" />
                                <span>Display button for intro duration</span>
                            </label>

                            <div class="fieldDescription">
                                If checked, skip button will remain visible throught the intro (offset and timeout are ignored).
                                <br />
                                Note: If unchecked, button will only appear in the player controls after the set timeout.
                            </div>
                        </div>

                        <div id="divShowPromptAdjustment" class="inputContainer">
                            <label class="inputLabel inputLabelUnfocused" for="ShowPromptAdjustment">
                                Skip prompt offset (in seoncds)
                            </label>
                            <input id="ShowPromptAdjustment" type="number" is="emby-input" min="0" />
                            <div class="fieldDescription">
                                Seconds to display skip prompt before introduction begins.
                            </div>
                        </div>
                        <br />

                        <div id="divHidePromptAdjustment" class="inputContainer">
                            <label class="inputLabel inputLabelUnfocused" for="HidePromptAdjustment">
                                Skip prompt timeout (in seconds)
                            </label>
                            <input id="HidePromptAdjustment" type="number" is="emby-input" min="2" />
                            <div class="fieldDescription">
                                Seconds after introduction before skip prompt is hidden.
                            </div>
                        </div>
                        <br />

                        <div class="inputContainer">
                            <label class="inputLabel inputLabelUnfocused" for="SecondsOfIntroToPlay">
                                Intro playback duration (in seconds)
                            </label>
                            <input id="SecondsOfIntroToPlay" type="number" is="emby-input" min="0" />
                            <div class="fieldDescription">
                                Seconds of introduction ending that should be played. Defaults to 2.
                            </div>
                        </div>

                        <details>
                            <summary>User Interface Customization</summary>

                            <br />
                            <div class="inputContainer">
                                <label class="inputLabel" for="SkipButtonIntroText">
                                    Skip intro button text
                                </label>
                                <input id="SkipButtonIntroText" type="text" is="emby-input" />
                                <div class="fieldDescription">
                                    Text to display in the skip intro button.
                                </div>
                            </div>

                            <div class="inputContainer">
                                <label class="inputLabel" for="SkipButtonEndCreditsText">
                                    Skip end credits button text
                                </label>
                                <input id="SkipButtonEndCreditsText" type="text" is="emby-input" />
                                <div class="fieldDescription">
                                    Text to display in the skip end credits button.
                                </div>
                            </div>

                            <div id="divAutoSkipNotificationText" class="inputContainer">
                                <label class="inputLabel" for="AutoSkipNotificationText">
                                    Automatic skip notification message
                                </label>
                                <input id="AutoSkipNotificationText" type="text" is="emby-input" />
                                <div class="fieldDescription">
                                    Message shown after automatically skipping an introduction. Leave blank to disable notification.
                                </div>
                            </div>

                            <div id="divAutoSkipCreditsNotificationText" class="inputContainer">
                                <label class="inputLabel" for="AutoSkipCreditsNotificationText">
                                    Automatic skip notification message
                                </label>
                                <input id="AutoSkipCreditsNotificationText" type="text" is="emby-input" />
                                <div class="fieldDescription">
                                    Message shown after automatically skipping credits. Leave blank to disable notification.
                                </div>
                            </div>
                        </details>
                    </fieldset>

                    <div>
                        <button is="emby-button" type="submit" class="raised button-submit block emby-button">
                            <span>Save</span>
                        </button>
                    </div>
                </form>
                <br />

                <fieldset class="verticalSection-extrabottompadding">
                    <legend>Advanced</legend>

                    <details id="support">
                        <summary>Support Bundle Info</summary>

                        <textarea id="supportBundle" rows="20" cols="75" readonly></textarea>
                    </details>

                    <details id="visualizer">
                        <summary>Manage Fingerprints</summary>

                        <br />
                        <label class="inputLabel" for="troubleshooterShow">Select TV Series to manage</label>
                        <select is="emby-select" id="troubleshooterShow" class="emby-select-withcolor emby-select"></select>
                        <label class="inputLabel" for="troubleshooterSeason">Select Season to manage</label>
                        <select is="emby-select" id="troubleshooterSeason" class="emby-select-withcolor emby-select"></select>
                        <br />

                        <label class="inputLabel" for="troubleshooterEpisode1">Select the first episode</label>
                        <select is="emby-select" id="troubleshooterEpisode1" class="emby-select-withcolor emby-select"></select>
                        <label class="inputLabel" for="troubleshooterEpisode1">Select the second episode</label>
                        <select is="emby-select" id="troubleshooterEpisode2" class="emby-select-withcolor emby-select"></select>
                        <br />

                        <div id="timestampEditor" style="display:none">
                            <h3 style="margin:0">Introduction timestamp editor</h3>
                            <p style="margin:0">All times are displayed in the format (HH:MM:SS)</p>
                            <br />
                            <table class="detailTable"> 
                                <tr>
                                    <th scope="col" class="detailTableHeaderCell">Episode</th>
                                    <th scope="col" class="detailTableHeaderCell">Section</th>
                                    <th scope="col" class="detailTableHeaderCell">Start Time</th>
                                    <th scope="col" class="detailTableHeaderCell">End Time</th>
                                </tr>
                                <tr>
                                    <td rowspan="2" id="editLeftEpisodeTitle"></td>
                                    <td>Intro</td>
                                    <td><input type="time" step="1" id="editLeftIntroEpisodeStart"></td>
                                    <td><input type="time" step="1" id="editLeftIntroEpisodeEnd"></td>
                                </tr>
                                <tr>
                                    <td>Credits</td>
                                    <td><input type="time" step="1" id="editLeftCreditEpisodeStart"></td>
                                    <td><input type="time" step="1" id="editLeftCreditEpisodeEnd"></td>
                                </tr>
                                <tr>
                                    <td rowspan="2" id="editRightEpisodeTitle"></td>
                                    <td>Intro</td>
                                    <td><input type="time" step="1" id="editRightIntroEpisodeStart"></td>
                                    <td><input type="time" step="1" id="editRightIntroEpisodeEnd"></td>
                                </tr>
                                <tr>
                                    <td>Credits</td>
                                    <td><input type="time" step="1" id="editRightCreditEpisodeStart"></td>
                                    <td><input type="time" step="1" id="editRightCreditEpisodeEnd"></td>
                                </tr>
                            </table>
                            <br />
                            <button is="emby-select" id="btnUpdateTimestamps" class="raised button-submit block emby-button" type="button">
                                Update timestamps
                            </button>
                            <br />
                        </div>

                        <div id="timestampErrorDiv" style="display:none">
                            <textarea id="timestampError" rows="2" cols="75" readonly></textarea>
                            <br />
                            <br />
                        </div>

                        <h3>Fingerprint Visualizer</h3>
                        <p>
                            Interactively compare the audio fingerprints of two episodes. <br />
                            The blue and red bar to the right of the fingerprint diff turns blue
                            when the corresponding fingerprint points are at least 80% similar.
                        </p>
                        <table>
                            <thead>
                                <tr>
                                    <td style="min-width: 100px; font-weight: bold">Key</td>
                                    <td style="font-weight: bold">Function</td>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>Up arrow</td>
                                    <td>
                                        Shift the left episode up by 0.1238 seconds.
                                        Holding control will shift the episode by 10 seconds.
                                    </td>
                                </tr>
                                <tr>
                                    <td>Down arrow</td>
                                    <td>
                                        Shift the left episode down by 0.1238 seconds.
                                        Holding control will shift the episode by 10 seconds.
                                    </td>
                                </tr>
                                <tr>
                                    <td>Right arrow</td>
                                    <td>Advance to the next pair of episodes.</td>
                                </tr>
                                <tr>
                                    <td>Left arrow</td>
                                    <td>Go back to the previous pair of episodes.</td>
                                </tr>
                            </tbody>
                        </table>
                        <br />

                        <span>Shift amount:</span>
                        <input type="number" min="-3000" max="3000" value="0" id="offset">
                        <br />
                        <span id="suggestedShifts">Suggested shifts:</span>
                        <br />
                        <br />

                        <canvas id="troubleshooter" style="display:none;"></canvas>
                        <span id="timestampContainer">
                            <span id="timestamps"></span> <br />
                            <span id="intros"></span>
                        </span>
                        <br />
                        <br />

                        <div id="eraseSeasonContainer" style="display: none;"> 
                            <button id="btnEraseSeasonTimestamps" type="button">
                                Erase all timestamps for this season
                            </button>

                            <input type="checkbox" id="eraseSeasonCacheCheckbox" style="margin-left: 10px;">
                            <label for="eraseSeasonCacheCheckbox" style="margin-left: 5px;">Erase cached fingerprint files</label>
                        </div>
                        <hr />

                        <button id="btnEraseIntroTimestamps">
                            Erase all introduction timestamps (globally)
                        </button>
                        <br />

                        <button id="btnEraseCreditTimestamps">
                            Erase all end credits timestamps (globally)
                        </button>
                        <br />

                        <input type="checkbox" id="eraseModeCacheCheckbox" style="margin-left: 10px;">
                        <label for="eraseModeCacheCheckbox" style="margin-left: 5px;">Erase cached fingerprint files</label>
                    </details>
                </fieldset>
            </div>
        </div>

        <script src="configurationpage?name=visualizer.js"></script>
        <script src="configurationpage?name=intro-config.js"></script>
    </div>
</body>

</html>
